angular.module("BootstrapAddons",["BootstrapAddonsTemplateCache"]),angular.module("BootstrapAddons").directive("timeslider",["$document","$timeout",function(t,e){const n="timesliderSvg",a=112,i=72,r=864e5;return{restrict:"E",scope:{end:"=",onClear:"&",onChange:"&",start:"=",width:"@"},templateUrl:"timeslider/timeslider.html",replace:!0,link:function(t,c,s){function l(){x.extent()[0].getTime()===x.extent()[1].getTime()?e(function(){t.onClear()()}):d3.event.sourceEvent?d3.select(this).transition().call(x.extent(d(x.extent()))).call(x.event):e(function(){t.onChange()(x.extent()[0],x.extent()[1])})}function d(e){var n=e[0],a=e[1],i=T.round(n),r=T.round(a);return i.getTime()===r.getTime()&&(i=T.floor(n),r=T.ceil(a)),i.getTime()<=t.start.getTime()&&(i=t.start),r.getTime()>=t.end.getTime()&&(r=t.end),[i,r]}function o(t,e){x.extent(d([t,e])),x(d3.select(".ba-brush")),x.event(d3.select(".ba-brush"))}function m(){t.actionIcon="glyphicon-play",y&&(clearInterval(y),y=null)}function u(){t.actionIcon="glyphicon-pause",y=setInterval(function(){t.stepForward()},1e3)}function g(){var e=x.extent()[1].getTime()-x.extent()[0].getTime();return 0>=e&&(e=(t.end.getTime()-t.start.getTime())/45),e}function p(){if(c[0].clientWidth>0){var t=null;x&&(t=x.extent()),h(),t&&t[0].getTime()!==t[1].getTime()&&(x.extent([t[0],t[1]]),x(d3.select(".ba-brush")))}}function h(){if(v&&(t.width=c[0].clientWidth-i),!(t.width<=0)){var e=t.width/a,r=t.end.getTime()-t.start.getTime(),s=d3.select("#ba-timeslider-container");s.selectAll("#"+n).remove();var d=s.append("svg").attr("id",n).attr("width",t.width).attr("height",22);d.append("g").append("rect").attr("x",0).attr("y",0).attr("width",t.width).attr("height",22).attr("class","ba-timeslider");var o=d3.time.scale.utc().domain([t.start.getTime(),t.end.getTime()]).range([0,parseInt(t.width,10)]),m=o(t.end.getTime()),u=null;o.ticks(e).forEach(function(t,e){var n=o(t);if(d.append("line").attr("class","ba-scaleline").attr("x1",n).attr("x2",n).attr("y1",0).attr("y2",22),n>25&&m-n>25){var a=b(r,t,u),i=a(t).split(" ");1===i.length&&i.push(""),u=t,d.append("text").attr("class","ba-scalelabel").attr("x",n).attr("dx",function(){var t="-1.25em";if(i[0].length>2)var t="-2.25em";return t}).attr("y",11).attr("text-anchor","left").attr("dominant-baseline","middle").text(i[0]),d.append("text").attr("class","ba-scalelabel").attr("x",n).attr("dx","0.25em").attr("y",11).attr("text-anchor","right").attr("dominant-baseline","middle").text(i[1])}}),x=d3.svg.brush().x(o).on("brushend",l),d.append("g").attr("class","ba-brush").call(x).selectAll("rect").attr("height",22)}}function b(t,e,n){var a=null;return a=r>=t?n?d3.time.format.utc("%H %M"):d3.time.format.utc("%a %d"):24192e5>=t?n&&e.getUTCDate()===n.getUTCDate()?d3.time.format.utc("%H %M"):d3.time.format.utc("%a %d"):31536e6>=t?d3.time.format.utc("%b %d"):n&&e.getUTCFullYear()===n.getUTCFullYear()?d3.time.format.utc("%b %d"):d3.time.format.utc("%b %Y")}function f(t){var e;switch(t){case"s":e=d3.time.second.utc;break;case"m":e=d3.time.minute.utc;break;case"h":e=d3.time.hour.utc;break;case"d":e=d3.time.day.utc;break;case"w":e=d3.time.week.utc;break;case"M":e=d3.time.month.utc;break;case"y":e=d3.time.year.utc;break;default:console.log("Unexpected snap interval: "+t+", defaulting to seconds."),e=d3.time.second.utc}return e}var x,T=f("s"),v=!1;t.width||(v=!0),t.actionIcon="glyphicon-play";var y=null;h(),t.$on("timesliderForceRender",function(){p()}),t.$on("timesliderSnapToNearest",function(t,e){T=f(e.snapToNearest),x.extent()[0].getTime()!==x.extent()[1].getTime()&&o(x.extent()[0],x.extent()[1])}),t.togglePlay=function(){y?m():u()},t.stepBack=function(){var e=new Date(x.extent()[0].getTime()-g()),n=x.extent()[0];n.getTime()<=t.start.getTime()&&(e=new Date(t.end.getTime()-g()),n=t.end),o(e,n)},t.stepForward=function(){var e=x.extent()[1],n=new Date(x.extent()[1].getTime()+g());e.getTime()>=t.end.getTime()&&(e=t.start,n=new Date(t.start.getTime()+g())),o(e,n)}}}}]),angular.module("BootstrapAddonsTemplateCache",[]).run(["$templateCache",function(t){t.put("timeslider/timeslider.html",'<div><div class="btn-group"><button class="btn btn-xs btn-primary" ng-click="togglePlay()"><span class="glyphicon {{actionIcon}}"></span></button> <button class="btn btn-xs btn-primary" ng-click="stepBack()"><span class="glyphicon glyphicon-step-backward"></span></button> <button class="btn btn-xs btn-primary" ng-click="stepForward()"><span class="glyphicon glyphicon-step-forward"></span></button> <span id="ba-timeslider-container"></span></div></div>')}]);